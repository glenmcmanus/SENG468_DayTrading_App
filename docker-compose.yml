version: "3.9"

services:

  fetch_server:
    image: python:3.8
    build:
      context: .
      dockerfile: LegacyServer/Dockerfile
    env_file:
      - .env
    ports:
      - ${FETCH_PORT}:${FETCH_PORT}
    networks:
      backend:
        ipv4_address: ${FETCH_IP}

  transaction_server:
    image: python:3.8
    build:
      context: .
      dockerfile: TransactionServer/Dockerfile
    env_file:
      - .env
    ports:
      - ${TRANSACTION_PORT}:${TRANSACTION_PORT}
    networks:
      backend:
        ipv4_address: ${TRANSACTION_IP}

  web_server:
    image: node:16
    build:
      context: .
      dockerfile: WebServer/Dockerfile
    env_file:
      - .env
    ports:
      - ${WEB_PORT}:${WEB_PORT}
    networks:
      backend:
        ipv4_address: ${WEB_IP}

networks:
  backend:
    driver: bridge
    ipam:
      config:
        - subnet: ${SUBNET}
          gateway: ${GATEWAY}