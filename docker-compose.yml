version: "3.9"

services:

  fetch_server:
    image: fetch_server
    build:
      context: ./LegacyServer
      dockerfile: ./Dockerfile
    env_file:
      - .env
      - ./LegacyServer/legacy.env
    ports:
      - ${FETCH_PORT}:${FETCH_PORT}
    networks:
      backend:
        ipv4_address: ${FETCH_IP}
    #entrypoint: [ "ls" ]

  transaction_server:
    image: transaction_server
    build:
      context: .
      dockerfile: ./TransactionServer/Dockerfile
    env_file:
      - .env
      - ./TransactionServer/transaction.env
    ports:
      - ${TRANSACTION_PORT}:${TRANSACTION_PORT}
    networks:
      backend:
        ipv4_address: ${TRANSACTION_IP}
    #entrypoint: [ "python", "-m", "TransactionServer.src.transactionServer" ]

  web_server:
    image: webserver
    build:
      context: ./webserver
      dockerfile: ./Dockerfile
    env_file:
      - .env
      - ./webserver/webserver.env
    ports:
      - ${WEB_PORT}:${WEB_PORT}
    networks:
      backend:
        ipv4_address: ${WEB_IP}

networks:
  backend:
    driver: bridge
    ipam:
      config:
        - subnet: ${SUBNET}
          gateway: ${GATEWAY}